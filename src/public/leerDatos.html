<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>Usuarios</title>
</head>

<body>
    <h1>Usuarios</h1>
    <a href="#" class="hero__cta">Add user</a>
    <table>
        <thead>
            <tr>
                <th>Id</th>
                <th>Nombre</th>
                <th>Edad</th>
                <th>Email</th>
                <th>Opciones</th>
            </tr>
        </thead>
        <tbody id="user-table">
        </tbody>
    </table>

    <section class="modal ">
        <div class="modal__container">
            <h2 class="Titulo" id="codi">Crear nuevo usuario</h2>
            <h2 class="Titulo" id="codigoUsuario"></h2>
            <form id='user-form'>
                <label for="name">Nombre:</label>
                <input type="text" id="name" name="name" required><br><br>

                <label for="age">Edad:</label>
                <input type="number" id="age" name="age" required><br><br>

                <label for="email">Correo electrónico:</label>
                <input type="email" id="email" name="email" required><br><br>

                <button id='create-user-btn' type="submit">Crear usuario</button>
                <button id='update-user-btn' type="submit">Editar usuario</button>
            </form>

            <a href="#" class="modal__close">Cerrar Modal</a>
        </div>
    </section>



    <script>
        const form = document.getElementById("user-form");
        const createUserButton = document.getElementById("create-user-btn");

        createUserButton.addEventListener("click", (event) => {
    event.preventDefault(); // prevenir que se envíe el formulario automáticamente

    const name = form.elements["name"].value;
    const age = form.elements["age"].value;
    const email = form.elements["email"].value;

    const data = { name, age, email };
    fetch("http://localhost:9000/api/users", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
    })
        .then((response) => response.json())
        .then((data) => {
            console.log(data);
            modal.classList.remove('modal--show');
            alert("Usuario registrado correctamente.");
            // Limpiar los campos del formulario
            form.elements["name"].value = "";
            form.elements["age"].value = "";
            form.elements["email"].value = "";
            // Actualizar la tabla
            const row = document.createElement('tr');
            const nameCell = document.createElement('td');
            const ageCell = document.createElement('td');
            const emailCell = document.createElement('td');
            const accionsCell = document.createElement('td');
            const updateButton = document.createElement('Button');
            const deleteButton = document.createElement('Button');

            nameCell.textContent = data.name;
            ageCell.textContent = data.age;
            emailCell.textContent = data.email;
            updateButton.classList.add("edit-btn");
            deleteButton.classList.add("delete-btn");
            updateButton.textContent = 'Update';
            deleteButton.textContent = 'Delete';
            accionsCell.appendChild(updateButton);
            accionsCell.appendChild(deleteButton);

            row.appendChild(nameCell);
            row.appendChild(ageCell);
            row.appendChild(emailCell);
            row.appendChild(accionsCell);
            

            userTableBody.appendChild(row);
        })
        .catch((error) => console.error(error));
});

        const openModal = document.querySelector('.hero__cta');
const modal = document.querySelector('.modal');
const closeModal = document.querySelector('.modal__close');

openModal.addEventListener('click', (e)=>{
    e.preventDefault();
    modal.classList.add('modal--show');
});

closeModal.addEventListener('click', (e)=>{
    e.preventDefault();
    modal.classList.remove('modal--show');
});
        const userTableBody = document.getElementById('user-table');


        const titulo = document.getElementById('codi');
        const codi = document.getElementById('codigoUsuario');
fetch('http://localhost:9000/api/users')
    .then(response => response.json())
    .then(data => {
        data.forEach(user => {
            const row = document.createElement('tr');
            const idCell = document.createElement('td');
            const nameCell = document.createElement('td');
            const ageCell = document.createElement('td');
            const emailCell = document.createElement('td');
            const accionsCell = document.createElement('td');
            const updateButton = document.createElement('Button');
            const deleteButton = document.createElement('Button');

            console.log(user._id);
            idCell.textContent = user._id;
            nameCell.textContent = user.name;
            ageCell.textContent = user.age;
            emailCell.textContent = user.email;
            updateButton.classList.add("edit-btn");
            deleteButton.classList.add("delete-btn");
            updateButton.textContent = 'Update';
            updateButton.onclick = (e)=>{
                console.log(e);
                
                modal.classList.add('modal--show');
                titulo.innerHTML = `Editar de ${user.name}`;
                codi.innerHTML = user._id;
                alert(`Actualizar usuario: ${user.name}, ${user.age}, ${user.email}`);
                form.elements["name"].value = user.name;
                form.elements["age"].value = user.age;
                form.elements["email"].value = user.email;

            }
            deleteButton.textContent = 'Delete';
            accionsCell.appendChild(updateButton);
            accionsCell.appendChild(deleteButton);

            row.appendChild(idCell);
            row.appendChild(nameCell);
            row.appendChild(ageCell);
            row.appendChild(emailCell);
            row.appendChild(accionsCell);

            userTableBody.appendChild(row);
        });
    })
    .catch(error => console.error(error));

    </script>
</body>

</html>
